openapi: 3.0.3
info:
  title: Firewall Defense Admin Service
  description: |
    Admin panel API that proxies requests to the API Service.
    This service provides a web UI for live operations management.
    
    All endpoints require authentication via session cookie (obtained via /login).
  version: 1.0.0
  contact:
    name: Into Games Workshop
servers:
  - url: http://localhost:4000
    description: Local development server
  - url: ${ADMIN_SERVICE_URL}
    description: Production server (set via environment variable)

tags:
  - name: Authentication
    description: Admin login
  - name: Proxy
    description: Endpoints that proxy to API Service

paths:
  /login:
    post:
      tags:
        - Authentication
      summary: Admin login
      description: Authenticate as admin and receive session cookie
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "admin"
                password:
                  type: string
                  format: password
                  example: "password123"
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: Session cookie for authenticated requests
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Invalid credentials"

  /api/game-config:
    get:
      tags:
        - Proxy
      summary: Get game configuration (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Game configuration retrieved
          content:
            application/json:
              schema:
                $ref: 'openapi-api-service.yaml#/components/schemas/GameConfig'
        '401':
          description: Unauthorized - missing or invalid session
        '500':
          description: Failed to fetch from API service

    post:
      tags:
        - Proxy
      summary: Update game configuration (proxies to API Service)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../openapi-api-service.yaml#/components/schemas/GameConfig'
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Unauthorized
        '500':
          description: Failed to update on API service

  /api/motd:
    get:
      tags:
        - Proxy
      summary: Get MOTD (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: MOTD retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  motd:
                    type: string
                    nullable: true
        '401':
          description: Unauthorized
        '500':
          description: Failed to fetch from API service

    post:
      tags:
        - Proxy
      summary: Update MOTD (proxies to API Service)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
      responses:
        '200':
          description: MOTD updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Unauthorized
        '500':
          description: Failed to update on API service

  /api/health:
    get:
      tags:
        - Proxy
      summary: Get health values (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Health values retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  health:
                    type: integer
                  maxHealth:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Failed to fetch from API service

    post:
      tags:
        - Proxy
      summary: Update health values (proxies to API Service)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                health:
                  type: integer
                maxHealth:
                  type: integer
      responses:
        '200':
          description: Health updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Unauthorized
        '500':
          description: Failed to update on API service

  /api/leaderboard:
    get:
      tags:
        - Proxy
      summary: Get full leaderboard (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Leaderboard retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: 'openapi-api-service.yaml#/components/schemas/AdminLeaderboardEntry'
        '401':
          description: Unauthorized
        '500':
          description: Failed to fetch from API service

    delete:
      tags:
        - Proxy
      summary: Flush leaderboard (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Leaderboard flushed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Unauthorized
        '500':
          description: Failed to flush on API service

  /api/leaderboard-flush-interval:
    get:
      tags:
        - Proxy
      summary: Get flush interval (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Flush interval retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  flushIntervalMinutes:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Failed to fetch from API service

    post:
      tags:
        - Proxy
      summary: Update flush interval (proxies to API Service)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - flushIntervalMinutes
              properties:
                flushIntervalMinutes:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: Flush interval updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Unauthorized
        '500':
          description: Failed to update on API service

  /api/leaderboard-flush-info:
    get:
      tags:
        - Proxy
      summary: Get flush info (proxies to API Service)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Flush info retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  lastFlush:
                    type: integer
                    format: int64
                    nullable: true
                  flushIntervalMinutes:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Failed to fetch from API service

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: session
      description: Session cookie obtained from /login

